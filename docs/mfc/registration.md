---
description: '詳細情報: 登録'
title: 登録
ms.date: 11/04/2016
helpviewer_keywords:
- servers [MFC], initializing
- initializing servers [MFC]
- OLE, registration
- installing servers [MFC]
- registry [MFC], OLE item database
- registration databases [MFC]
- servers [MFC], installing
- OLE server applications [MFC], registering servers
ms.assetid: 991d5684-72c1-4f9e-a09a-9184ed12bbb9
ms.openlocfilehash: 8254f4b1ab8a005623650794adc8be0bd06cfdff
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/11/2020
ms.locfileid: "97218122"
---
# <a name="registration"></a>登録

ユーザーが OLE 項目をアプリケーションに挿入する場合、OLE は選択するオブジェクトの種類の一覧を表示します。 OLE は、すべてのサーバーアプリケーションによって提供される情報を含むシステム登録データベースからこの一覧を取得します。 サーバー自体が登録されると、システム登録データベース (レジストリ) に格納されるエントリによって、提供されるオブジェクトの種類、ファイル拡張子、およびその他の情報のパスが記述されます。

フレームワークと OLE システムのダイナミックリンクライブラリ (DLL) は、このレジストリを使用して、システムで使用できる OLE 項目の種類を判別します。 また、OLE システム Dll は、このレジストリを使用して、リンクまたは埋め込みオブジェクトがアクティブ化されたときにサーバーアプリケーションを起動する方法を決定します。

この記事では、各サーバーアプリケーションのインストール時と実行時に必要な操作について説明します。

システム登録データベースの詳細および更新に使用する .reg ファイルの形式については、 *OLE プログラマーリファレンス* を参照してください。

## <a name="server-installation"></a><a name="_core_server_installation"></a> サーバーのインストール

サーバーアプリケーションを初めてインストールするときは、サポートするすべての種類の OLE 項目を登録する必要があります。 また、スタンドアロンアプリケーションとして実行するたびに、サーバーでシステム登録データベースを更新することもできます。 これにより、サーバーの実行可能ファイルが移動された場合に、登録データベースが最新の状態に保たれます。

> [!NOTE]
> アプリケーションウィザードによって生成された MFC アプリケーションは、スタンドアロンアプリケーションとして実行されるときに自動的に登録されます。

インストール中にアプリケーションを登録する場合は、RegEdit.exe プログラムを使用します。 アプリケーションにセットアッププログラムを含める場合は、セットアッププログラムで "RegEdit/S *appname*. reg" を実行してください。 /S フラグはサイレント操作を示します。つまり、コマンドが正常に完了したことを報告するダイアログボックスは表示されません。それ以外の場合は、RegEdit を手動で実行するようにユーザーに指示します。

> [!NOTE]
> アプリケーションウィザードによって作成された .reg ファイルには、実行可能ファイルの完全なパスが含まれていません。 インストールプログラムでは、実行可能ファイルへの完全なパスを含むように .reg ファイルを変更するか、インストールディレクトリを含めるように PATH 環境変数を変更する必要があります。

RegEdit は、.reg テキストファイルの内容を登録データベースにマージします。 データベースを確認する、または修復するには、レジストリエディターを使用します。 必須の OLE エントリを削除しないように注意してください。

## <a name="server-initialization"></a><a name="_core_server_initialization"></a> サーバーの初期化

アプリケーションウィザードを使用してサーバーアプリケーションを作成すると、ウィザードによってすべての初期化タスクが自動的に完了します。 ここでは、サーバーアプリケーションを手動で作成する場合に必要な操作について説明します。

サーバーアプリケーションがコンテナーアプリケーションによって起動されると、OLE システム Dll によって、サーバーのコマンドラインに "/Embedding" オプションが追加されます。 サーバーアプリケーションの動作は、コンテナーによって起動されたかどうかによって異なります。そのため、アプリケーションが実行を開始するときに最初に実行する必要があるのは、コマンドラインで "/Embedding" または "-埋め込み" オプションを確認することです。 このスイッチが存在する場合は、サーバーがアクティブまたは完全に開いている状態であることを示す別のリソースのセットを読み込みます。 詳細については、「 [メニューとリソース: サーバーの追加](../mfc/menus-and-resources-server-additions.md)」を参照してください。

また、サーバーアプリケーションは、 `CWinApp::RunEmbedded` コマンドラインを解析するためにその関数を呼び出す必要があります。 0以外の値を返す場合、アプリケーションは、スタンドアロンアプリケーションとしてではなく、コンテナーアプリケーションから実行されているため、ウィンドウを表示しません。 この関数は、システム登録データベース内のサーバーのエントリを更新し、メンバー関数を呼び出して `RegisterAll` インスタンスの登録を行います。

サーバーアプリケーションを起動するときに、インスタンスの登録を実行できることを確認する必要があります。 インスタンス登録は、サーバーがアクティブであり、コンテナーから要求を受信する準備ができていることを OLE システム Dll に通知します。 登録データベースにエントリは追加されません。 によって定義されたメンバー関数を呼び出すことによって、サーバーのインスタンス登録を実行 `ConnectTemplate` `COleTemplateServer` します。 これにより、オブジェクトがオブジェクトに接続され `CDocTemplate` `COleTemplateServer` ます。

関数は、 `ConnectTemplate` サーバーの *CLSID*、オブジェクトへのポインター `CDocTemplate` 、およびサーバーが複数のインスタンスをサポートしているかどうかを示すフラグの3つのパラメーターを受け取ります。 ミニサーバーは複数のインスタンスをサポートできる必要があります。つまり、サーバーの複数のインスタンスが同時に実行されるようにする必要があります (コンテナーごとに1つ)。 そのため、ミニパスを起動するときに、このフラグに **TRUE** を渡します。

ミニコンテナーを作成する場合は、定義上、常にコンテナーによって起動されます。 引き続きコマンドラインを解析して、"/Embedding" オプションを確認する必要があります。 コマンドラインでこのオプションを指定しないと、ユーザーは、スタンドアロンアプリケーションとしてミニユーザーを起動しようとしたことになります。 この問題が発生した場合は、システム登録データベースにサーバーを登録し、コンテナーアプリケーションからミニサーバーを起動するようにユーザーに通知するメッセージボックスを表示します。

## <a name="see-also"></a>関連項目

[OLE●ole○](../mfc/ole-in-mfc.md)<br/>
[サーバー](../mfc/servers.md)<br/>
[CWinApp:: RunAutomated](../mfc/reference/cwinapp-class.md#runautomated)<br/>
[CWinApp:: RunEmbedded](../mfc/reference/cwinapp-class.md#runembedded)<br/>
[COleTemplateServer クラス](../mfc/reference/coletemplateserver-class.md)
