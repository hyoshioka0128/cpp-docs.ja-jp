---
description: '詳細情報: ダイナセット'
title: ダイナセット
ms.date: 11/04/2016
helpviewer_keywords:
- ODBC recordsets, dynasets
- ODBC cursor library [ODBC], dynasets
- keyset-driven cursors in dynasets
- cursors [ODBC], keyset-driven cursors in dynasets
- cursor library [ODBC], dynaset availability
- recordsets [C++], dynasets
- dynasets
ms.assetid: 2867e6be-208e-4fe7-8bbe-b8697cb1045c
ms.openlocfilehash: 3c4a8edf1d0058045affc436bb8c9ee1c7e8bf4d
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/11/2020
ms.locfileid: "97239676"
---
# <a name="dynaset"></a>ダイナセット

このトピックでは、ダイナセットについて説明し、その [可用性](#_core_availability_of_dynasets)について説明します。

> [!NOTE]
> このトピックは、MFC ODBC クラス ( [CRecordset](../../mfc/reference/crecordset-class.md)を含む) に適用されます。 DAO クラスのダイナセットの詳細については、「 [CDaoRecordset](../../mfc/reference/cdaorecordset-class.md)」を参照してください。 DAO では、ダイナセット型のレコードセットを開くことができます。

ダイナセットは、動的プロパティを持つレコードセットです。 有効期間中、ダイナセットモードのレコードセットオブジェクト (通常はダイナセットと呼ばれます) は、次のようにデータソースと同期されたままになります。 マルチユーザー環境では、他のユーザーが、ダイナセットに含まれるレコードを編集または削除したり、ダイナセットが表すテーブルにレコードを追加したりすることができます。 レコードセットに対するアプリケーションの追加または削除が、ダイナセットに反映されます。 他のユーザーがテーブルに追加したレコードは、そのメンバー関数を呼び出すことによって、ダイナセットを再構築するまで、ダイナセットには反映されません `Requery` 。 他のユーザーがレコードを削除すると、MFC コードによってレコードセット内の削除がスキップされます。 既存のレコードに対する他のユーザーの編集変更は、影響を受けるレコードまでスクロールするとすぐに、ダイナセットに反映されます。

同様に、ダイナセット内のレコードに対して行った編集は、他のユーザーが使用しているダイナセットに反映されます。 追加したレコードは、ダイナセットを再クエリするまで、他のユーザーのダイナセットには反映されません。 削除したレコードは、他のユーザーのレコードセットでは "削除済み" としてマークされます。 同じデータベースへの複数の接続 (複数 `CDatabase` のオブジェクト) がある場合、それらの接続に関連付けられているレコードセットは、他のユーザーのレコードセットと同じ状態になります。

ダイナセットは、航空会社の予約システムなど、データを動的にする必要がある場合に最も役立ちます。

> [!NOTE]
> ダイナセットを使用するには、ダイナセットをサポートするデータソース用の ODBC ドライバーが必要です。また、ODBC カーソルライブラリを読み込むことはできません。 詳細については、「 [ダイナセットの可用性](#_core_availability_of_dynasets)」を参照してください。

レコードセットがダイナセットであることを指定するには、 `CRecordset::dynaset` `Open` レコードセットオブジェクトのメンバー関数に最初のパラメーターとしてを渡します。

> [!NOTE]
> 更新可能なダイナセットの場合、ODBC ドライバーは、配置された update ステートメントまたは odbc API 関数のいずれかをサポートする必要があり `::SQLSetPos` ます。 両方がサポートされている場合、MFC は `::SQLSetPos` 効率を向上させるためにを使用します。

## <a name="availability-of-dynasets"></a><a name="_core_availability_of_dynasets"></a> ダイナセットの可用性

MFC データベースクラスでは、次の要件を満たしている場合、ダイナセットがサポートされます。

- ODBC カーソルライブラリ DLL は、このデータソースに使用されていない必要があります。

   カーソルライブラリを使用すると、ダイナセットのサポートに必要な、基になる ODBC ドライバーの一部の機能がマスクされます。 ダイナセットを使用する場合 (このセクションの残りの部分で説明するように、ODBC ドライバーがダイナセットに必要な機能を備えている場合)、オブジェクトの作成時に MFC によってカーソルライブラリが読み込まれないようにすることができ `CDatabase` ます。 詳細につい[ては、](../../mfc/reference/cdatabase-class.md#openex) 「 [ODBC](../../data/odbc/odbc-basics.md) 」および「クラスのメンバー関数を[開く](../../mfc/reference/cdatabase-class.md#open)」を参照してください `CDatabase` 。

   ODBC の用語では、ダイナセットとスナップショットはカーソルと呼ばれます。 カーソルは、レコードセット内のその位置を追跡するために使用されるメカニズムです。

- データソースの ODBC ドライバーでキーセットドリブンカーソルがサポートされている必要があります。

   キーセットドリブンカーソルは、キーのセットを取得して格納することによって、テーブルのデータを管理します。 キーは、ユーザーが特定のレコードにスクロールしたときにテーブルから現在のデータを取得するために使用されます。 ドライバーがこのサポートを提供するかどうかを判断するには、 `::SQLGetInfo` *SQL_SCROLL_OPTIONS* パラメーターを指定して ODBC API 関数を呼び出します。

   キーセットをサポートしていないダイナセットを開こうとすると、 `CDBException` AFX_SQL_ERROR_DYNASET_NOT_SUPPORTED リターンコード値を持つが取得されます。

- データソースの ODBC ドライバーでは、拡張フェッチがサポートされている必要があります。

   拡張フェッチとは、SQL クエリの結果として得られるレコードを前後にスクロールする機能です。 ドライバーがこの機能をサポートしているかどうかを判断するには、 `::SQLGetFunctions` *SQL_API_SQLEXTENDEDFETCH* パラメーターを使用して ODBC API 関数を呼び出します。

更新可能なダイナセット (またはスナップショット) を必要とする場合は、odbc ドライバーが `::SQLSetPos` ODBC API 関数または位置指定更新のいずれかをサポートしている必要があります。 `::SQLSetPos`関数を使用すると、SQL ステートメントを送信せずにデータソースを更新できます。 このサポートが利用可能な場合、MFC では、SQL を使用して更新を行うために、このサポートを優先的に使用します。 ドライバーでがサポートされているかどうかを判断するには `::SQLSetPos` 、 `::SQLGetInfo` *SQL_POS_OPERATIONS* パラメーターを指定してを呼び出します。

位置指定更新では、  \<cursorname> データソース上のテーブル内の特定の行を識別するために SQL 構文 (という形式の) を使用します。 ドライバーが位置指定更新をサポートしているかどうかを判断するには、SQL_POSITIONED_STATEMENTS パラメーターを指定してを呼び出し `::SQLGetInfo` ます。 

一般に、MFC のダイナセット (前方参照専用レコードセットではありません) には、レベル2の API 準拠の ODBC ドライバーが必要です。 データソースのドライバーがレベル1の API セットに準拠している場合でも、更新可能なスナップショットと読み取り専用のスナップショットと順方向専用のレコードの両方を使用できますが、ダイナセットは使用できません。 ただし、拡張フェッチとキーセットドリブンカーソルがサポートされている場合は、レベル1のドライバーでダイナセットがサポートされることがあります。 ODBC 準拠レベルの詳細については、「 [odbc](../../data/odbc/odbc-basics.md)」を参照してください。

> [!NOTE]
> スナップショットとダイナセットの両方を使用する場合は、2つの異なる `CDatabase` オブジェクト (2 つの異なる接続) に基づいて作成する必要があります。

ODBC カーソルライブラリによって保持されている中間ストレージを使用するスナップショットとは異なり、ダイナセットは、スクロールするとすぐにデータソースから直接レコードをフェッチします。 これにより、ダイナセットによって最初に選択されたレコードがデータソースと同期されます。

Visual C++ のこのバージョンに含まれている ODBC ドライバー一覧、および他のドライバーを取得する方法については、「[ODBC ドライバーの一覧](../../data/odbc/odbc-driver-list.md)」を参照してください。

## <a name="see-also"></a>関連項目

[Open Database Connectivity (ODBC)](../../data/odbc/open-database-connectivity-odbc.md)
