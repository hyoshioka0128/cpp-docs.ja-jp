---
description: 詳細については、「方法:/clr を使用して MFC および ATL コードをコンパイルする」を参照してください。
title: 方法:-clr を使用して MFC および ATL コードをコンパイルする
ms.custom: get-started-article
ms.date: 11/04/2016
helpviewer_keywords:
- MFC [C++], interoperability
- ATL [C++], interoperability
- mixed assemblies [C++], MFC code
- mixed assemblies [C++], ATL code
- /clr compiler option [C++], compiling ATL and MFC code
- interoperability [C++], /clr compiler option
- regular MFC DLLs [C++], /clr compiler option
- interop [C++], /clr compiler option
- extension DLLs [C++], /clr compiler option
ms.assetid: 12464bec-33a4-482c-880a-c078de7f6ea5
ms.openlocfilehash: 67a861dac3b4c4b454f4fbde4a500c3677ce0e25
ms.sourcegitcommit: d6af41e42699628c3e2e6063ec7b03931a49a098
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 12/11/2020
ms.locfileid: "97304494"
---
# <a name="how-to-compile-mfc-and-atl-code-by-using-clr"></a>方法: /clr を使用して MFC および ATL コードをコンパイルする

このトピックでは、共通言語ランタイムを対象とするために、既存の MFC および ATL プログラムをコンパイルする方法について説明します。

### <a name="to-compile-an-mfc-executable-or-regular-mfc-dll-by-using-clr"></a>/Clr を使用して MFC 実行可能ファイルまたは通常の MFC DLL をコンパイルするには

1. **ソリューションエクスプローラー** でプロジェクトを右クリックし、[**プロパティ**] をクリックします。

1. [ **プロジェクトのプロパティ** ] ダイアログボックスで、[ **構成プロパティ** ] の横にあるノードを展開し、[ **全般**] を選択します。 右側のウィンドウの [ **プロジェクトの既定値**] で、[ **共通言語ランタイム** サポート] を [ **共通言語ランタイムサポート (/clr)**] に設定します。

   同じウィンドウで、[ **mfc の使用** ] が **共有 DLL で mfc を使用** するように設定されていることを確認します。

1. [ **構成プロパティ**] で、[ **C/c + +** ] の横にあるノードを展開し、[ **全般**] を選択します。 **デバッグ情報の形式** が ( **/zi** ではなく)**プログラムデータベース/zi** に設定されていることを確認します。

1. [ **コード生成** ] ノードを選択します。 **最小リビルドを有効** にする **(/Gm-)** を設定します。 また、 **基本ランタイムチェック** を **既定値** に設定します。

1. [ **構成プロパティ**] で、[ **C/c + +** ]、[ **コード生成**] の順に選択します。 **ランタイムライブラリ** が **マルチスレッドデバッグ dll (/mdd)** または **マルチスレッド DLL (/md)** のいずれかに設定されていることを確認します。

1. Stdafx.h で、次の行を追加します。

    ```
    #using <System.Windows.Forms.dll>
    ```

### <a name="to-compile-an-mfc-extension-dll-by-using-clr"></a>/Clr を使用して MFC 拡張 DLL をコンパイルするには

1. 「/Clr を使用して MFC の実行可能ファイルまたはレギュラー MFC DLL をコンパイルするには」の手順に従います。

1. [ **構成プロパティ**] で、[ **C/c + +** ] の横にあるノードを展開し、[ **プリコンパイル済みヘッダー**] を選択します。 プリコンパイル済みヘッダー **を使用しない** ように、**作成/使用プリコンパイル済みヘッダー** を設定します。

   または、 **ソリューションエクスプローラー** で、[stdafx.h] を右クリックし、[ **プロパティ**] をクリックします。 [ **構成プロパティ**] で、[ **C/c + +** ] の横にあるノードを展開し、[ **全般**] を選択します。 共通言語ランタイムサポートを **使用してコンパイル** を設定します。 **共通言語ランタイムサポートはありません**。

1. DllMain を含むファイルとそれが呼び出すすべてのファイルについて、 **ソリューションエクスプローラー** でファイルを右クリックし、[ **プロパティ**] をクリックします。 [ **構成プロパティ**] で、[ **C/c + +** ] の横にあるノードを展開し、[ **全般**] を選択します。 右側のウィンドウの [ **プロジェクトの既定値**] で、[ **共通言語ランタイムサポートでコンパイル** する] を [ **共通言語ランタイムサポートなし**] に設定します。

### <a name="to-compile-an-atl-executable-by-using-clr"></a>/Clr を使用して ATL 実行可能ファイルをコンパイルするには

1. **ソリューションエクスプローラー** で、プロジェクトを右クリックし、[**プロパティ**] をクリックします。

1. [ **プロジェクトのプロパティ** ] ダイアログボックスで、[ **構成プロパティ** ] の横にあるノードを展開し、[ **全般**] を選択します。 右側のウィンドウの [ **プロジェクトの既定値**] で、[ **共通言語ランタイム** サポート] を [ **共通言語ランタイムサポート (/clr)**] に設定します。

1. [ **構成プロパティ**] で、[ **C/c + +** ] の横にあるノードを展開し、[ **全般**] を選択します。 **デバッグ情報の形式** が ( **/zi** ではなく)**プログラムデータベース/zi** に設定されていることを確認します。

1. [ **コード生成** ] ノードを選択します。 **最小リビルドを有効** にする **(/Gm-)** を設定します。 また、 **基本ランタイムチェック** を **既定値** に設定します。

1. [ **構成プロパティ**] で、[ **C/c + +** ]、[ **コード生成**] の順に選択します。 **ランタイムライブラリ** が **マルチスレッドデバッグ dll (/mdd)** または **マルチスレッド DLL (/md)** のいずれかに設定されていることを確認します。

1. MIDL によって生成されたすべてのファイル (C ファイル) について、 **ソリューションエクスプローラー** でファイルを右クリックし、[ **プロパティ**] をクリックします。 [ **構成プロパティ**] で、[ **C/c + +** ] の横にあるノードを展開し、[ **全般**] を選択します。 共通言語ランタイムサポートを **使用してコンパイル** を設定します。 **共通言語ランタイムサポートはありません**。

### <a name="to-compile-an-atl-dll-by-using-clr"></a>/Clr を使用して ATL DLL をコンパイルするには

1. 「/Clr を使用して ATL 実行可能ファイルをコンパイルするには」セクションの手順に従います。

1. [ **構成プロパティ**] で、[ **C/c + +** ] の横にあるノードを展開し、[ **プリコンパイル済みヘッダー**] を選択します。 プリコンパイル済みヘッダー **を使用しない** ように、**作成/使用プリコンパイル済みヘッダー** を設定します。

   または、 **ソリューションエクスプローラー** で、[stdafx.h] を右クリックし、[ **プロパティ**] をクリックします。 [ **構成プロパティ**] で、[ **C/c + +** ] の横にあるノードを展開し、[ **全般**] を選択します。 共通言語ランタイムサポートを **使用してコンパイル** を設定します。 **共通言語ランタイムサポートはありません**。

1. DllMain を含むファイルとそれが呼び出すすべてのファイルについて、 **ソリューションエクスプローラー** でファイルを右クリックし、[ **プロパティ**] をクリックします。 [ **構成プロパティ**] で、[ **C/c + +** ] の横にあるノードを展開し、[ **全般**] を選択します。 右側のウィンドウの [ **プロジェクトの既定値**] で、[ **共通言語ランタイムサポートでコンパイル** する] を [ **共通言語ランタイムサポートなし**] に設定します。

## <a name="see-also"></a>関連項目

[混合 (ネイティブおよびマネージ) アセンブリ](../dotnet/mixed-native-and-managed-assemblies.md)
